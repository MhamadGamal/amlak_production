function _createForOfIteratorHelper(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==a.return||a.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"0rIZ":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a("vkgz"),n=a("fXoL"),o=a("nm5K"),s=function(){var e=function(){function e(t){_classCallCheck(this,e),this.apiService=t}return _createClass(e,[{key:"getClients",value:function(){var e=this;return this.apiService.getReq("clients/").pipe(Object(r.a)((function(t){t.status&&(e.clients=t.data)})))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(n.Zb(o.a))},e.\u0275prov=n.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},"5aeq":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("vkgz"),n=a("fXoL"),o=a("nm5K"),s=a("IYfF"),i=function(){var e=function(){function e(t,a){_classCallCheck(this,e),this.apiService=t,this.authService=a}return _createClass(e,[{key:"getProjects",value:function(){var e=this;return this.apiService.getReq("projects/").pipe(Object(r.a)((function(t){t.status&&(e.projects=t.data)})))}},{key:"findProject",value:function(e){return this.projects.find((function(t){return t.id===Number(e)}))}},{key:"editableProject",set:function(e){this._editableProject=e},get:function(){return this._editableProject}},{key:"projects",set:function(e){this._projects=e},get:function(){return this._projects}}]),e}();return e.\u0275fac=function(t){return new(t||e)(n.Zb(o.a),n.Zb(s.a))},e.\u0275prov=n.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},"PTt/":function(e,t,a){"use strict";a.d(t,"a",(function(){return F}));var r=a("fXoL"),n=a("3Pt+"),o=a("nm5K"),s=a("mAmA"),i=a("IYfF"),l=a("ofXK");function u(e,t){1&e&&r.Nb(0,"i",23)}function c(e,t){1&e&&r.Nb(0,"i",24)}function m(e,t){if(1&e){var a=r.Sb();r.Rb(0,"div",16),r.Rb(1,"div"),r.Nb(2,"i",17),r.Hc(3," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),r.Qb(),r.Rb(4,"div"),r.Rb(5,"button",18),r.Fc(6,u,1,0,"i",19),r.Fc(7,c,1,0,"i",20),r.Qb(),r.Rb(8,"button",21),r.dc("click",(function(){r.yc(a);var e=r.hc();return e.addGeneralSummary({steps_explain:null,consultant_general_summary:null,company_general_summary:null}),e.deleteGeneralSummary.emit({show:!1,type:e.type})})),r.Nb(9,"i",22),r.Qb(),r.Qb(),r.Qb()}if(2&e){var n=r.hc();r.zb(5),r.oc("disabled",n.showLoader&&!(null!=n.authService&&null!=n.authService.userData&&n.authService.userData.add_edit)),r.zb(1),r.oc("ngIf",!n.showLoader),r.zb(1),r.oc("ngIf",n.showLoader),r.zb(1),r.Ab("disabled",null==n.authService||null==n.authService.userData||!n.authService.userData.add_edit||null)}}function g(e,t){1&e&&r.Nb(0,"i",23)}function d(e,t){1&e&&r.Nb(0,"i",24)}function p(e,t){if(1&e){var a=r.Sb();r.Rb(0,"div",25),r.Rb(1,"button",18),r.Fc(2,g,1,0,"i",19),r.Fc(3,d,1,0,"i",20),r.Qb(),r.Rb(4,"button",21),r.dc("click",(function(){r.yc(a);var e=r.hc();return e.generalSummaryForm.markAsDirty(),e.addReport({steps_explain:null,consultant_general_summary:null,company_general_summary:null},!0)})),r.Nb(5,"i",22),r.Qb(),r.Qb()}if(2&e){var n=r.hc();r.zb(1),r.oc("disabled",n.showLoader&&!(null!=n.authService&&null!=n.authService.userData&&n.authService.userData.add_edit)),r.zb(1),r.oc("ngIf",!n.showLoader),r.zb(1),r.oc("ngIf",n.showLoader),r.zb(1),r.Ab("disabled",null==n.authService||null==n.authService.userData||!n.authService.userData.add_edit||null)}}function f(e,t){1&e&&(r.Rb(0,"div",26),r.Hc(1," pdf file "),r.Qb())}function h(e,t){if(1&e&&(r.Rb(0,"a",32),r.Hc(1," \u0639\u0631\u0636 "),r.Qb()),2&e){var a=r.hc(2);r.oc("href",a.data.company_general_summary,r.Ac)}}function b(e,t){if(1&e&&(r.Rb(0,"div",27),r.Fc(1,h,2,1,"a",28),r.Rb(2,"label",29),r.Nb(3,"input",30),r.Nb(4,"span",31),r.Hc(5," \u062d\u0630\u0641 "),r.Qb(),r.Qb()),2&e){var a=r.hc();r.Bb(a.data.company_general_summary?"justify-content-between":"justify-content-end"),r.zb(1),r.oc("ngIf",a.data.company_general_summary),r.zb(2),r.Ab("disabled",null==a.authService||null==a.authService.userData||!a.authService.userData.add_edit||null)}}function y(e,t){1&e&&(r.Rb(0,"div",26),r.Hc(1," pdf file "),r.Qb())}function _(e,t){if(1&e&&(r.Rb(0,"a",32),r.Hc(1," \u0639\u0631\u0636 "),r.Qb()),2&e){var a=r.hc(2);r.oc("href",a.data.consultant_general_summary,r.Ac)}}function v(e,t){if(1&e&&(r.Rb(0,"div",27),r.Fc(1,_,2,1,"a",28),r.Rb(2,"label",29),r.Nb(3,"input",33),r.Nb(4,"span",31),r.Hc(5," \u062d\u0630\u0641 "),r.Qb(),r.Qb()),2&e){var a=r.hc();r.Bb(a.data.consultant_general_summary?"justify-content-between":"justify-content-end"),r.zb(1),r.oc("ngIf",a.data.consultant_general_summary),r.zb(2),r.Ab("disabled",null==a.authService||null==a.authService.userData||!a.authService.userData.add_edit||null)}}function S(e,t){if(1&e){var a=r.Sb();r.Rb(0,"div",40),r.Rb(1,"span",41),r.dc("click",(function(){r.yc(a);var e=t.$implicit,n=t.index;return r.hc(2).delteImg(e.id,n)})),r.Nb(2,"i",42),r.Qb(),r.Nb(3,"img",43),r.Qb()}if(2&e){var n=t.$implicit;r.zb(3),r.oc("src",n.image,r.Ac)}}function w(e,t){if(1&e){var a=r.Sb();r.Rb(0,"div",34),r.Rb(1,"label",6),r.Hc(2," \u0635\u0648\u0631 \u0627\u0644\u0645\u0634\u0631\u0648\u0639 "),r.Qb(),r.Rb(3,"div",35),r.Rb(4,"a",36),r.Nb(5,"i",37),r.Rb(6,"input",38),r.dc("change",(function(e){return r.yc(a),r.hc().onuploadImage(e)})),r.Qb(),r.Qb(),r.Fc(7,S,4,1,"div",39),r.Qb(),r.Qb()}if(2&e){var n=r.hc();r.zb(6),r.Ab("disabled",null==n.authService||null==n.authService.userData||!n.authService.userData.add_edit||null),r.zb(1),r.oc("ngForOf",n.projectImgs)}}var F=function(){var e=function(){function e(t,a,n,o){_classCallCheck(this,e),this.formBuilder=t,this.apiService=a,this.toaster=n,this.authService=o,this.reportPage=!1,this.deleteGeneralSummary=new r.n,this.refreshSummary=new r.n,this.formData=new FormData,this.showLoader=!1,this.projectImgs=[],this.pageType="add",this.imgCounter=1,this.formSubmitted=!1}return _createClass(e,[{key:"ngOnChanges",value:function(){this.data&&(this.pageType="edit")}},{key:"ngOnInit",value:function(){this.createForm(),this.data&&(this.generalSummaryForm.patchValue({steps_explain:this.data.steps_explain,consultant_general_summary:this.data.consultant_general_summary,company_general_summary:this.data.company_general_summary}),this.data.report_images&&(this.projectImgs=this.data.report_images,this.imgCounter=this.projectImgs.length+1),this.pageType="edit")}},{key:"createForm",value:function(){this.generalSummaryForm=this.formBuilder.group({steps_explain:[null,[n.q.required]],company_general_summary:[null],delete_company_general_summary:[null],consultant_general_summary:[null],delete_consultant_general_summary:[null]})}},{key:"addGeneralSummary",value:function(e){var t=this;if(this.formSubmitted=!0,this.generalSummaryForm.valid&&this.generalSummaryForm.dirty){this.showLoader=!0,this.formData.append("steps_explain",e.steps_explain);var a=this.formData;null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary&&(a=e),this.generalSummaryForm.get("delete_company_general_summary").value&&(this.formData.append("company_general_summary",""),this.generalSummaryForm.get("company_general_summary").setValue(null),this.generalSummaryForm.get("delete_company_general_summary").setValue(null)),this.generalSummaryForm.get("delete_consultant_general_summary").value&&(this.formData.append("consultant_general_summary",""),this.generalSummaryForm.get("consultant_general_summary").setValue(null),this.generalSummaryForm.get("delete_consultant_general_summary").setValue(null)),this.apiService.patchReq("main-stages/".concat(this.mainStageId,"/"),a).subscribe((function(a){a.status?(null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary?(t.toaster.showSuccess("\u062a\u0645\u062a \u0645\u0633\u062d \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),t.generalSummaryForm.reset(),t.projectImgs=[]):(t.toaster.showSuccess("\u062a\u0645\u062a \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0628\u0646\u062c\u0627\u062d"),t.generalSummaryForm.markAsPristine()),t.refreshSummary.emit(!0)):t.toaster.showError(a.errors.length?a.errors[0].split(":")[1]:a.message),t.showLoader=!1}),(function(e){t.toaster.showError(),t.showLoader=!1}))}}},{key:"uploadReport",value:function(e,t){var a=e.target.files[0];switch(this.generalSummaryForm.markAsDirty(),t){case"company_general_summary":this.formData.append("company_general_summary",a,a.name),this.generalSummaryForm.get("company_general_summary").setValue(a);break;case"consultant_general_summary":this.formData.append("consultant_general_summary",a,a.name),this.generalSummaryForm.get("consultant_general_summary").setValue(a)}}},{key:"addReport",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a||(this.formSubmitted=!0),this.generalSummaryForm.valid&&this.generalSummaryForm.dirty){this.showLoader=!0,this.formData.append("steps_explain",e.steps_explain),this.formData.append("project",String(this.projectId)),this.formData.append("stage_type",String(this.stageType)),this.formData.append("is_report",String(!0));var r=this.formData;null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary&&((r=e).project=this.projectId,r.stage_type=this.stageType,r.is_report=!0),this.generalSummaryForm.get("delete_company_general_summary").value&&(this.formData.append("company_general_summary",""),this.generalSummaryForm.get("company_general_summary").setValue(null),this.generalSummaryForm.get("delete_company_general_summary").setValue(null)),this.generalSummaryForm.get("delete_consultant_general_summary").value&&(this.formData.append("consultant_general_summary",""),this.generalSummaryForm.get("consultant_general_summary").setValue(null),this.generalSummaryForm.get("delete_consultant_general_summary").setValue(null)),"add"===this.pageType?this.apiService.patchReq("main-stages/",r).subscribe((function(a){a.status?(null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary?(t.toaster.showSuccess("\u062a\u0645\u062a \u0645\u0633\u062d \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),t.generalSummaryForm.reset(),t.projectImgs=[]):(t.toaster.showSuccess("\u062a\u0645\u062a \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0628\u0646\u062c\u0627\u062d"),t.generalSummaryForm.markAsPristine()),t.refreshSummary.emit(!0)):t.toaster.showError(a.errors.length?a.errors[0].split(":")[1]:a.message),t.showLoader=!1}),(function(e){t.toaster.showError(),t.showLoader=!1})):this.apiService.patchReq("main-stages/".concat(this.mainStageId,"/?is_report=true"),r).subscribe((function(a){a.status?(null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary?(t.toaster.showSuccess("\u062a\u0645\u062a \u0645\u0633\u062d \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),t.generalSummaryForm.reset(),t.projectImgs=[]):(t.toaster.showSuccess("\u062a\u0645\u062a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0628\u0646\u062c\u0627\u062d"),t.generalSummaryForm.markAsPristine()),t.refreshSummary.emit(!0)):t.toaster.showError(a.errors.length?a.errors[0].split(":")[1]:a.message),t.showLoader=!1}),(function(e){t.toaster.showError(),t.showLoader=!1}))}}},{key:"onuploadImage",value:function(e){var t,a=this,r=_createForOfIteratorHelper(e.target.files);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.generalSummaryForm.markAsDirty(),this.formData.append("image_"+this.imgCounter,n,n.name),this.imgCounter++;var o=new FileReader;o.onload=function(e){a.projectImgs.push({image:e.target.result})},o.readAsDataURL(n)}}catch(s){r.e(s)}finally{r.f()}}},{key:"delteImg",value:function(e,t){var a=this;e?this.apiService.deleteReq("report-images/".concat(e,"/")).subscribe((function(e){e.status?(a.toaster.showSuccess("\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0635\u0648\u0631\u0647"),a.projectImgs.splice(t,1),a.formData.delete("image_"+t+1)):a.toaster.showError(e.errors.length?e.errors[0].split(":")[1]:e.message)}),(function(e){a.toaster.showError()})):(this.projectImgs.splice(t,1),this.formData.delete("image_"+t+1))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Mb(n.c),r.Mb(o.a),r.Mb(s.a),r.Mb(i.a))},e.\u0275cmp=r.Gb({type:e,selectors:[["general-summary"]],inputs:{projectId:"projectId",reportPage:"reportPage",type:"type",data:"data",mainStageId:"mainStageId",stageType:"stageType"},outputs:{deleteGeneralSummary:"deleteGeneralSummary",refreshSummary:"refreshSummary"},features:[r.xb],decls:31,vars:13,consts:[[1,"form",3,"formGroup","ngSubmit"],["class","d-flex justify-content-between btns head",4,"ngIf"],["class","d-flex justify-content-end btns",4,"ngIf"],[1,"row"],[1,"col-12"],[1,"form-group"],[1,"control-label"],[1,"annotation-required"],["rows","4","formControlName","steps_explain",1,"form-control"],[1,"col-md-6"],[1,"file"],["type","file","accept","application/pdf",1,"form-control",3,"change"],["class","report-name",4,"ngIf"],[1,"fas","fa-paperclip"],["class","d-flex report-options",3,"class",4,"ngIf"],["class","imgs",4,"ngIf"],[1,"d-flex","justify-content-between","btns","head"],[1,"fas","fa-file-alt"],["type","submit",1,"save",3,"disabled"],["class","fas fa-check",4,"ngIf"],["class","fas fa-spinner",4,"ngIf"],["type","button",1,"delete",3,"click"],[1,"fas","fa-trash-alt"],[1,"fas","fa-check"],[1,"fas","fa-spinner"],[1,"d-flex","justify-content-end","btns"],[1,"report-name"],[1,"d-flex","report-options"],["target","blank","class","show",3,"href",4,"ngIf"],[1,"checkbox-container"],["type","checkbox","formControlName","delete_company_general_summary"],[1,"checkmark"],["target","blank",1,"show",3,"href"],["type","checkbox","formControlName","delete_consultant_general_summary"],[1,"imgs"],[1,"d-flex"],[1,"img-upload","my-1"],[1,"fas","fa-plus-circle"],["type","file","multiple","",3,"change"],["class","m-1 img-holder",4,"ngFor","ngForOf"],[1,"m-1","img-holder"],[3,"click"],[1,"fas","fa-times"],["width","100","height","100",1,"",3,"src"]],template:function(e,t){1&e&&(r.Rb(0,"form",0),r.dc("ngSubmit",(function(){return t.reportPage?t.addReport(t.generalSummaryForm.value):t.addGeneralSummary(t.generalSummaryForm.value)})),r.Fc(1,m,10,4,"div",1),r.Fc(2,p,6,4,"div",2),r.Rb(3,"div",3),r.Rb(4,"div",4),r.Rb(5,"div",5),r.Rb(6,"label",6),r.Hc(7," \u0634\u0631\u062d \u0627\u0644\u062e\u0637\u0648\u0627\u062a "),r.Rb(8,"span",7),r.Hc(9,"*"),r.Qb(),r.Qb(),r.Nb(10,"textarea",8),r.Qb(),r.Qb(),r.Qb(),r.Rb(11,"div",3),r.Rb(12,"div",9),r.Rb(13,"div",5),r.Rb(14,"label",6),r.Hc(15," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0644\u0644\u0634\u0631\u0643\u0629 "),r.Qb(),r.Rb(16,"div",10),r.Rb(17,"input",11),r.dc("change",(function(e){return t.uploadReport(e,"company_general_summary")})),r.Qb(),r.Fc(18,f,2,0,"div",12),r.Qb(),r.Nb(19,"i",13),r.Qb(),r.Fc(20,b,6,4,"div",14),r.Qb(),r.Rb(21,"div",9),r.Rb(22,"div",5),r.Rb(23,"label",6),r.Hc(24," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0644\u0644\u0627\u0633\u062a\u0634\u0627\u0631\u064a "),r.Qb(),r.Rb(25,"div",10),r.Rb(26,"input",11),r.dc("change",(function(e){return t.uploadReport(e,"consultant_general_summary")})),r.Qb(),r.Fc(27,y,2,0,"div",12),r.Qb(),r.Nb(28,"i",13),r.Qb(),r.Fc(29,v,6,4,"div",14),r.Qb(),r.Qb(),r.Fc(30,w,8,2,"div",15),r.Qb()),2&e&&(r.oc("formGroup",t.generalSummaryForm),r.zb(1),r.oc("ngIf",!t.reportPage),r.zb(1),r.oc("ngIf",t.reportPage),r.zb(8),r.Eb("err",t.formSubmitted&&t.generalSummaryForm.get("steps_explain").invalid),r.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),r.zb(7),r.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),r.zb(1),r.oc("ngIf",t.generalSummaryForm.get("company_general_summary").value),r.zb(2),r.oc("ngIf",t.generalSummaryForm.get("company_general_summary").value),r.zb(6),r.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),r.zb(1),r.oc("ngIf",t.generalSummaryForm.get("consultant_general_summary").value),r.zb(2),r.oc("ngIf",t.generalSummaryForm.get("consultant_general_summary").value),r.zb(1),r.oc("ngIf",t.reportPage))},directives:[n.s,n.k,n.e,l.l,n.b,n.j,n.d,n.a,l.k],styles:[".d-flex.head[_ngcontent-%COMP%]{background-color:#186076;color:#fff;padding:5px}.d-flex.head[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff}.d-flex[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;margin-right:5px;border:none;cursor:pointer}.d-flex[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{color:#bc4747}.imgs[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-wrap:wrap}.imgs[_ngcontent-%COMP%]   .img-holder[_ngcontent-%COMP%]{position:relative;width:100px;height:100px}.imgs[_ngcontent-%COMP%]   .img-holder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:0;top:0;background-color:#186076;width:20px;height:20px;line-height:20px;text-align:center;color:#fff}span.txt-red[_ngcontent-%COMP%]{margin-top:-20px}.report-name[_ngcontent-%COMP%], a.show[_ngcontent-%COMP%], span.txt-red[_ngcontent-%COMP%]{font-size:.9rem}.checkbox-container[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]{right:10px;height:12px;width:12px}.checkbox-container[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{left:3px;top:0;width:4px;height:9px}.report-options[_ngcontent-%COMP%]{margin-top:-15px}"]}),e}()}}]);