(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"0rIZ":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var r=a("vkgz"),n=a("fXoL"),s=a("nm5K");let o=(()=>{class e{constructor(e){this.apiService=e}getClients(){return this.apiService.getReq("clients/").pipe(Object(r.a)(e=>{e.status&&(this.clients=e.data)}))}}return e.\u0275fac=function(t){return new(t||e)(n.Zb(s.a))},e.\u0275prov=n.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},"5aeq":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("vkgz"),n=a("fXoL"),s=a("nm5K"),o=a("IYfF");let i=(()=>{class e{constructor(e,t){this.apiService=e,this.authService=t}set editableProject(e){this._editableProject=e}get editableProject(){return this._editableProject}set projects(e){this._projects=e}get projects(){return this._projects}getProjects(){return this.apiService.getReq("projects/").pipe(Object(r.a)(e=>{e.status&&(this.projects=e.data)}))}findProject(e){return this.projects.find(t=>t.id===Number(e))}}return e.\u0275fac=function(t){return new(t||e)(n.Zb(s.a),n.Zb(o.a))},e.\u0275prov=n.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},"PTt/":function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var r=a("fXoL"),n=a("3Pt+"),s=a("nm5K"),o=a("mAmA"),i=a("ofXK");function c(e,t){1&e&&r.Nb(0,"i",22)}function l(e,t){1&e&&r.Nb(0,"i",23)}function u(e,t){if(1&e){const e=r.Sb();r.Rb(0,"div",15),r.Rb(1,"div"),r.Nb(2,"i",16),r.Hc(3," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),r.Qb(),r.Rb(4,"div"),r.Rb(5,"button",17),r.Fc(6,c,1,0,"i",18),r.Fc(7,l,1,0,"i",19),r.Qb(),r.Rb(8,"button",20),r.dc("click",(function(){r.yc(e);const t=r.hc();return t.addGeneralSummary({steps_explain:null,consultant_general_summary:null,company_general_summary:null}),t.deleteGeneralSummary.emit({show:!1,type:t.type})})),r.Nb(9,"i",21),r.Qb(),r.Qb(),r.Qb()}if(2&e){const e=r.hc();r.zb(5),r.oc("disabled",e.showLoader),r.zb(1),r.oc("ngIf",!e.showLoader),r.zb(1),r.oc("ngIf",e.showLoader)}}function m(e,t){1&e&&r.Nb(0,"i",22)}function p(e,t){1&e&&r.Nb(0,"i",23)}function g(e,t){if(1&e){const e=r.Sb();r.Rb(0,"div",24),r.Rb(1,"button",17),r.Fc(2,m,1,0,"i",18),r.Fc(3,p,1,0,"i",19),r.Qb(),r.Rb(4,"button",20),r.dc("click",(function(){return r.yc(e),r.hc().addReport({steps_explain:null,consultant_general_summary:null,company_general_summary:null})})),r.Nb(5,"i",21),r.Qb(),r.Qb()}if(2&e){const e=r.hc();r.zb(1),r.oc("disabled",e.showLoader),r.zb(1),r.oc("ngIf",!e.showLoader),r.zb(1),r.oc("ngIf",e.showLoader)}}function d(e,t){1&e&&(r.Rb(0,"div",25),r.Hc(1," pdf file "),r.Qb())}function h(e,t){1&e&&(r.Rb(0,"div",25),r.Hc(1," pdf file "),r.Qb())}function b(e,t){if(1&e){const e=r.Sb();r.Rb(0,"div",32),r.Rb(1,"span",33),r.dc("click",(function(){r.yc(e);const a=t.$implicit,n=t.index;return r.hc(2).delteImg(a.id,n)})),r.Nb(2,"i",34),r.Qb(),r.Nb(3,"img",35),r.Qb()}if(2&e){const e=t.$implicit;r.zb(3),r.oc("src",e.image,r.Ac)}}function f(e,t){if(1&e){const e=r.Sb();r.Rb(0,"div",26),r.Rb(1,"label",6),r.Hc(2," \u0635\u0648\u0631 \u0627\u0644\u0645\u0634\u0631\u0648\u0639 "),r.Qb(),r.Rb(3,"div",27),r.Rb(4,"a",28),r.Nb(5,"i",29),r.Rb(6,"input",30),r.dc("change",(function(t){return r.yc(e),r.hc().onuploadImage(t)})),r.Qb(),r.Qb(),r.Fc(7,b,4,1,"div",31),r.Qb(),r.Qb()}if(2&e){const e=r.hc();r.zb(7),r.oc("ngForOf",e.projectImgs)}}let _=(()=>{class e{constructor(e,t,a){this.formBuilder=e,this.apiService=t,this.toaster=a,this.reportPage=!1,this.deleteGeneralSummary=new r.n,this.formData=new FormData,this.showLoader=!1,this.projectImgs=[],this.pageType="add",this.imgCounter=1}ngOnInit(){this.createForm(),this.data&&(this.generalSummaryForm.patchValue({steps_explain:this.data.steps_explain,consultant_general_summary:this.data.consultant_general_summary,company_general_summary:this.data.company_general_summary}),this.data.report_images&&(this.projectImgs=this.data.report_images,this.imgCounter=this.projectImgs.length+1),this.pageType="edit")}createForm(){this.generalSummaryForm=this.formBuilder.group({steps_explain:[null,[n.p.required]],company_general_summary:[null],consultant_general_summary:[null]})}addGeneralSummary(e){if(this.generalSummaryForm.valid){this.showLoader=!0,this.formData.append("steps_explain",e.steps_explain);let t=this.formData;null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary&&(t=e),this.apiService.patchReq(`main-stages/${this.mainStageId}/`,t).subscribe(t=>{t.status?null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary?(this.toaster.showSuccess("\u062a\u0645\u062a \u0645\u0633\u062d \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),this.generalSummaryForm.reset()):this.toaster.showSuccess("\u062a\u0645\u062a \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0628\u0646\u062c\u0627\u062d"):this.toaster.showError(t.errors.length?t.errors[0]:t.message),this.showLoader=!1},e=>{this.toaster.showError(),this.showLoader=!1})}}uploadReport(e,t){const a=e.target.files[0];switch(t){case"company_general_summary":this.formData.append("company_general_summary",a,a.name),this.generalSummaryForm.get("company_general_summary").setValue(a);break;case"consultant_general_summary":this.formData.append("consultant_general_summary",a,a.name),this.generalSummaryForm.get("consultant_general_summary").setValue(a)}}addReport(e){this.showLoader=!0,this.formData.append("steps_explain",e.steps_explain),this.formData.append("project",String(this.projectId)),this.formData.append("stage_type",String(this.stageType)),this.formData.append("is_report",String(!0));let t=this.formData;null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary&&(t=e,t.project=this.projectId,t.stage_type=this.stageType,t.is_report=!0),"add"===this.pageType?this.apiService.postReq("main-stages/",t).subscribe(t=>{t.status?null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary?(this.toaster.showSuccess("\u062a\u0645\u062a \u0645\u0633\u062d \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),this.generalSummaryForm.reset()):this.toaster.showSuccess("\u062a\u0645\u062a \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0628\u0646\u062c\u0627\u062d"):this.toaster.showError(t.errors.length?t.errors[0]:t.message),this.showLoader=!1},e=>{this.toaster.showError(),this.showLoader=!1}):this.apiService.patchReq(`main-stages/${this.mainStageId}/?is_report=true`,t).subscribe(t=>{t.status?null===e.steps_explain&&null===e.consultant_general_summary&&null===e.company_general_summary?(this.toaster.showSuccess("\u062a\u0645\u062a \u0645\u0633\u062d \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),this.generalSummaryForm.reset()):this.toaster.showSuccess("\u062a\u0645\u062a \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0628\u0646\u062c\u0627\u062d"):this.toaster.showError(t.errors.length?t.errors[0]:t.message),this.showLoader=!1},e=>{this.toaster.showError(),this.showLoader=!1})}onuploadImage(e){const t=e.target.files[0];this.formData.append("image_"+this.imgCounter,t,t.name),this.imgCounter++;const a=new FileReader;a.onload=e=>{this.projectImgs.push({image:e.target.result})},a.readAsDataURL(e.target.files[0])}delteImg(e,t){e?this.apiService.deleteReq(`report-images/${e}/`).subscribe(e=>{e.status?(this.toaster.showSuccess("\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0635\u0648\u0631\u0647"),this.projectImgs.splice(t,1),this.formData.delete("image_"+t+1)):this.toaster.showError(e.errors.length?e.errors[0]:e.message)},e=>{this.toaster.showError()}):(this.projectImgs.splice(t,1),this.formData.delete("image_"+t+1))}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(n.c),r.Mb(s.a),r.Mb(o.a))},e.\u0275cmp=r.Gb({type:e,selectors:[["general-summary"]],inputs:{projectId:"projectId",reportPage:"reportPage",type:"type",data:"data",mainStageId:"mainStageId",stageType:"stageType"},outputs:{deleteGeneralSummary:"deleteGeneralSummary"},decls:29,vars:6,consts:[[1,"form",3,"formGroup","ngSubmit"],["class","d-flex justify-content-between btns head",4,"ngIf"],["class","d-flex justify-content-end btns",4,"ngIf"],[1,"row"],[1,"col-12"],[1,"form-group"],[1,"control-label"],[1,"annotation-required"],["rows","4","formControlName","steps_explain",1,"form-control"],[1,"col-md-6"],[1,"file"],["type","file","accept","application/pdf",1,"form-control",3,"change"],["class","report-name",4,"ngIf"],[1,"fas","fa-paperclip"],["class","imgs",4,"ngIf"],[1,"d-flex","justify-content-between","btns","head"],[1,"fas","fa-file-alt"],["type","submit",1,"save",3,"disabled"],["class","fas fa-check",4,"ngIf"],["class","fas fa-spinner",4,"ngIf"],["type","button",1,"delete",3,"click"],[1,"fas","fa-trash-alt"],[1,"fas","fa-check"],[1,"fas","fa-spinner"],[1,"d-flex","justify-content-end","btns"],[1,"report-name"],[1,"imgs"],[1,"d-flex"],[1,"img-upload","my-1"],[1,"fas","fa-plus-circle"],["type","file",3,"change"],["class","m-1 img-holder",4,"ngFor","ngForOf"],[1,"m-1","img-holder"],[3,"click"],[1,"fas","fa-times"],["width","100","height","100",1,"",3,"src"]],template:function(e,t){1&e&&(r.Rb(0,"form",0),r.dc("ngSubmit",(function(){return t.reportPage?t.addReport(t.generalSummaryForm.value):t.addGeneralSummary(t.generalSummaryForm.value)})),r.Fc(1,u,10,3,"div",1),r.Fc(2,g,6,3,"div",2),r.Rb(3,"div",3),r.Rb(4,"div",4),r.Rb(5,"div",5),r.Rb(6,"label",6),r.Hc(7," \u0634\u0631\u062d \u0627\u0644\u062e\u0637\u0648\u0627\u062a "),r.Rb(8,"span",7),r.Hc(9,"*"),r.Qb(),r.Qb(),r.Nb(10,"textarea",8),r.Qb(),r.Qb(),r.Qb(),r.Rb(11,"div",3),r.Rb(12,"div",9),r.Rb(13,"div",5),r.Rb(14,"label",6),r.Hc(15," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0644\u0644\u0634\u0631\u0643\u0629 "),r.Qb(),r.Rb(16,"div",10),r.Rb(17,"input",11),r.dc("change",(function(e){return t.uploadReport(e,"company_general_summary")})),r.Qb(),r.Fc(18,d,2,0,"div",12),r.Qb(),r.Nb(19,"i",13),r.Qb(),r.Qb(),r.Rb(20,"div",9),r.Rb(21,"div",5),r.Rb(22,"label",6),r.Hc(23," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 \u0644\u0644\u0627\u0633\u062a\u0634\u0627\u0631\u064a "),r.Qb(),r.Rb(24,"div",10),r.Rb(25,"input",11),r.dc("change",(function(e){return t.uploadReport(e,"consultant_general_summary")})),r.Qb(),r.Fc(26,h,2,0,"div",12),r.Qb(),r.Nb(27,"i",13),r.Qb(),r.Qb(),r.Qb(),r.Fc(28,f,8,1,"div",14),r.Qb()),2&e&&(r.oc("formGroup",t.generalSummaryForm),r.zb(1),r.oc("ngIf",!t.reportPage),r.zb(1),r.oc("ngIf",t.reportPage),r.zb(16),r.oc("ngIf",t.generalSummaryForm.get("company_general_summary").value),r.zb(8),r.oc("ngIf",t.generalSummaryForm.get("consultant_general_summary").value),r.zb(2),r.oc("ngIf",t.reportPage))},directives:[n.r,n.j,n.e,i.l,n.b,n.i,n.d,i.k],styles:[".d-flex.head[_ngcontent-%COMP%]{background-color:#186076;color:#fff;padding:5px}.d-flex.head[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff}.d-flex[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;margin-right:5px;border:none;cursor:pointer}.d-flex[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{color:#bc4747}.imgs[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-wrap:wrap}.imgs[_ngcontent-%COMP%]   .img-holder[_ngcontent-%COMP%]{position:relative;width:100px;height:100px}.imgs[_ngcontent-%COMP%]   .img-holder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:0;top:0;background-color:#186076;width:20px;height:20px;line-height:20px;text-align:center;color:#fff}"]}),e})()},Pd9Q:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("fXoL");let n=(()=>{class e{constructor(e){this._el=e}onInputChange(e){const t=this._el.nativeElement.value;this._el.nativeElement.value=t.replace(/[^0-9]*/g,""),t!==this._el.nativeElement.value&&e.stopPropagation()}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(r.l))},e.\u0275dir=r.Hb({type:e,selectors:[["","numbersOnly",""]],hostBindings:function(e,t){1&e&&r.dc("input",(function(e){return t.onInputChange(e)}))}}),e})()}}]);