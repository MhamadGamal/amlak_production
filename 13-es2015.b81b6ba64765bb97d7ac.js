(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{A6Zd:function(e,t,a){"use strict";a.r(t),a.d(t,"ProjectsModule",(function(){return Y}));var i=a("ofXK"),n=a("tyNb"),r=a("cxbk"),s=a("PdH4"),o=a.n(s),c=a("3Pt+"),u=a("fXoL"),l=a("0rIZ"),d=a("nm5K"),b=a("mAmA"),h=a("5aeq"),p=a("IYfF"),m=a("Pd9Q"),g=a("4M/A");function f(e,t){1&e&&u.Nb(0,"i",47)}function S(e,t){1&e&&u.Nb(0,"i",48)}function v(e,t){1&e&&(u.Rb(0,"span",49),u.Ic(1," \u0627\u062e\u062a\u0631 \u062d\u0627\u0644\u0629 \u0627\u0644\u0645\u0631\u062d\u0644\u0647 "),u.Qb())}function _(e,t){1&e&&(u.Rb(0,"div",50),u.Ic(1," pdf file "),u.Qb())}function y(e,t){if(1&e&&(u.Rb(0,"a",56),u.Ic(1," \u0639\u0631\u0636 "),u.Qb()),2&e){const e=u.hc(2);u.oc("href",e.data.company_report,u.Bc)}}function R(e,t){if(1&e&&(u.Rb(0,"div",51),u.Gc(1,y,2,1,"a",52),u.Rb(2,"label",53),u.Nb(3,"input",54),u.Nb(4,"span",55),u.Ic(5," \u062d\u0630\u0641 "),u.Qb(),u.Qb()),2&e){const e=u.hc();u.Bb(e.data.company_report?"justify-content-between":"justify-content-end"),u.zb(1),u.oc("ngIf",e.data.company_report),u.zb(2),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null)}}function Q(e,t){1&e&&(u.Rb(0,"div",50),u.Ic(1," pdf file "),u.Qb())}function I(e,t){if(1&e&&(u.Rb(0,"a",56),u.Ic(1," \u0639\u0631\u0636 "),u.Qb()),2&e){const e=u.hc(2);u.oc("href",e.data.consultant_report,u.Bc)}}function j(e,t){if(1&e&&(u.Rb(0,"div",51),u.Gc(1,I,2,1,"a",52),u.Rb(2,"label",53),u.Nb(3,"input",57),u.Nb(4,"span",55),u.Ic(5," \u062d\u0630\u0641 "),u.Qb(),u.Qb()),2&e){const e=u.hc();u.Bb(e.data.consultant_report?"justify-content-between":"justify-content-end"),u.zb(1),u.oc("ngIf",e.data.consultant_report),u.zb(2),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null)}}function x(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",58),u.Rb(1,"span",59),u.dc("click",(function(){u.zc(e);const a=t.$implicit,i=t.index;return u.hc().delteImg(a.id,i)})),u.Nb(2,"i",60),u.Qb(),u.Nb(3,"img",61),u.Qb()}if(2&e){const e=t.$implicit;u.zb(3),u.oc("src",e.image,u.Bc)}}let F=(()=>{class e{constructor(e,t,a,i){this.formBuilder=e,this.apiService=t,this.toaster=a,this.authService=i,this.deleteSubStage=new u.n,this.refresh=new u.n,this.projectImgs=[],this.submittedProjectImgs=[],this.subStageFormSubmitted=!1,this.showLoader=!1,this.pageType="add",this.imgCounter=1,this.delete_consultant_report=!1,this.delete_company_report=!1}ngOnChanges(){this.data&&(this.pageType="edit")}ngOnInit(){this.createForm(),this.data?(this.pageType="edit",this.id=this.data.id,this.data.images&&(this.projectImgs=this.data.images,this.imgCounter=this.projectImgs.length+1),this.subStageForm.patchValue({name:this.data.name,steps_explain:this.data.steps_explain,status:this.data.status.key,stop_reason:this.data.stop_reason,completion_rate:this.data.completion_rate,company_report:this.data.company_report,consultant_report:this.data.consultant_report,camera_link:this.data.camera_link})):this.id=null}createForm(){this.subStageForm=this.formBuilder.group({name:[null,[c.q.required]],steps_explain:[null,[c.q.required]],status:[null,[c.q.required]],stop_reason:[""],completion_rate:[null,[c.q.required]],company_report:[null],delete_company_report:[null],consultant_report:[null],delete_consultant_report:[null],camera_link:[""]})}onuploadImage(e){for(let t of e.target.files){this.subStageForm.markAsDirty(),this.submittedProjectImgs.push({img:"image_"+this.imgCounter,file:t,fileName:t.name}),this.imgCounter++;const e=new FileReader;e.onload=e=>{this.projectImgs.push({image:e.target.result})},e.readAsDataURL(t)}}delteImg(e,t){e?this.apiService.deleteReq(`sub-stage-images/${e}/`).subscribe(e=>{e.status?(this.toaster.showSuccess("\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0635\u0648\u0631\u0647"),this.projectImgs.splice(t,1),this.submittedProjectImgs.splice(t,1)):this.toaster.showError(e.errors.length?e.errors[0].split(":")[1]:e.message)},e=>{this.toaster.showError()}):(this.projectImgs.splice(t,1),this.submittedProjectImgs.splice(t,1))}addSubStage(e){if(e.main_stage=this.mainStageId,this.subStageFormSubmitted=!0,this.subStageForm.valid&&this.subStageForm.dirty){const t=new FormData;this.showLoader=!0,t.append("main_stage",e.main_stage),t.append("name",e.name),t.append("steps_explain",e.steps_explain),t.append("status",e.status),t.append("stop_reason",e.stop_reason),t.append("completion_rate",e.completion_rate),this.subStageForm.get("company_report").value&&this.subStageForm.get("company_report").value.name&&t.append("company_report",this.subStageForm.get("company_report").value,this.subStageForm.get("company_report").value.name),this.subStageForm.get("delete_company_report").value&&(t.append("company_report",""),this.subStageForm.get("company_report").setValue(null),this.subStageForm.get("delete_company_report").setValue(null)),this.subStageForm.get("delete_consultant_report").value&&(t.append("consultant_report",""),this.subStageForm.get("consultant_report").setValue(null),this.subStageForm.get("delete_consultant_report").setValue(null)),this.subStageForm.get("consultant_report").value&&this.subStageForm.get("consultant_report").value.name&&t.append("consultant_report",this.subStageForm.get("consultant_report").value,this.subStageForm.get("consultant_report").value.name),this.submittedProjectImgs.length&&this.submittedProjectImgs.forEach(e=>{t.append(e.img,e.file,e.fileName)}),t.append("camera_link",e.camera_link),"add"===this.pageType?this.apiService.postReq("sub-stages/",t).subscribe(e=>{e.status?(this.toaster.showSuccess("\u062a\u0645\u062a \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0631\u062d\u0644\u0647 \u0628\u0646\u062c\u0627\u062c"),this.refresh.emit(!0),this.subStageForm.markAsPristine()):this.toaster.showError(e.errors.length?e.errors[0].split(":")[1]:e.message),this.showLoader=!1},e=>{this.showLoader=!1,this.toaster.showError()}):"edit"===this.pageType&&this.apiService.patchReq(`sub-stages/${this.data.id}/`,t).subscribe(e=>{e.status?(this.toaster.showSuccess("\u062a\u0645\u062a \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0645\u0631\u062d\u0644\u0647 \u0628\u0646\u062c\u0627\u062c"),this.subStageForm.markAsPristine()):this.toaster.showError(e.errors.length?e.errors[0].split(":")[1]:e.message),this.showLoader=!1},e=>{this.showLoader=!1,this.toaster.showError()})}}uploadReport(e,t){this.subStageForm.markAsDirty();const a=e.target.files[0];switch(t){case"company_report":this.subStageForm.get("company_report").setValue(a);break;case"consultant_report":this.subStageForm.get("consultant_report").setValue(a)}}}return e.\u0275fac=function(t){return new(t||e)(u.Mb(c.c),u.Mb(d.a),u.Mb(b.a),u.Mb(p.a))},e.\u0275cmp=u.Gb({type:e,selectors:[["sub-stage"]],inputs:{type:"type",index:"index",mainStageId:"mainStageId",data:"data"},outputs:{deleteSubStage:"deleteSubStage",refresh:"refresh"},features:[u.xb],decls:96,vars:46,consts:[[1,"form",3,"formGroup","ngSubmit"],[1,"d-flex","justify-content-end","btns"],["type","submit",1,"save",3,"disabled"],["class","fas fa-check",4,"ngIf"],["class","fas fa-spinner",4,"ngIf"],["type","button",1,"delete",3,"click"],[1,"fas","fa-trash-alt"],[1,"row"],[1,"col-12"],[1,"control-label"],[1,"annotation-required"],[1,"form-group"],["maxlength","200","type","text","formControlName","name",1,"form-control"],["rows","4","formControlName","steps_explain",1,"form-control"],[1,"row","no-gutters","justify-content-between"],[1,"col-md-2","col-sm-4"],[1,"radio"],[1,"radio__input"],["type","radio","formControlName","status","value","1"],[1,"radio__control"],[1,"radio__label"],[1,"col-md-3","col-sm-4"],["type","radio","formControlName","status","value","2"],["type","radio","formControlName","status","value","3"],[1,"col-md-4"],["type","text","placeholder","\u0633\u0628\u0628 \u0627\u0644\u062a\u0648\u0642\u0641","formControlName","stop_reason",1,"form-control","p-1","mt-1"],["class","txt-red",4,"ngIf"],[1,"col-lg-5"],[1,"row","no-gutters","justify-content-between","mt-1"],[1,"col-8"],["maxlength","3","type","text","numbersOnly","","formControlName","completion_rate",1,"form-control","mt-1"],[1,"col-4","mt-2"],[3,"containerHeight","scale","strokeWidth","radius","outerStrokeColor","percent"],[1,"col-lg-7"],["type","text","formControlName","camera_link",1,"form-control"],[1,"col-lg-6"],[1,"file"],["type","file","accept","application/pdf",1,"form-control",3,"change"],["class","report-name",4,"ngIf"],[1,"fas","fa-paperclip"],["class","d-flex report-options",3,"class",4,"ngIf"],[1,"imgs"],[1,"d-flex"],[1,"img-upload","my-1"],[1,"fas","fa-plus-circle"],["type","file","multiple","",3,"change"],["class","m-1 img-holder",4,"ngFor","ngForOf"],[1,"fas","fa-check"],[1,"fas","fa-spinner"],[1,"txt-red"],[1,"report-name"],[1,"d-flex","report-options"],["target","blank","class","show",3,"href",4,"ngIf"],[1,"checkbox-container"],["type","checkbox","formControlName","delete_company_report"],[1,"checkmark"],["target","blank",1,"show",3,"href"],["type","checkbox","formControlName","delete_consultant_report"],[1,"m-1","img-holder"],[3,"click"],[1,"fas","fa-times"],["width","100","height","100",1,"",3,"src"]],template:function(e,t){1&e&&(u.Rb(0,"form",0),u.dc("ngSubmit",(function(){return t.addSubStage(t.subStageForm.value)})),u.Rb(1,"div",1),u.Rb(2,"button",2),u.Gc(3,f,1,0,"i",3),u.Gc(4,S,1,0,"i",4),u.Qb(),u.Rb(5,"button",5),u.dc("click",(function(){return t.deleteSubStage.emit({index:t.index,type:t.type,id:t.id})})),u.Nb(6,"i",6),u.Qb(),u.Qb(),u.Rb(7,"div",7),u.Rb(8,"div",8),u.Rb(9,"label",9),u.Ic(10," \u0627\u0633\u0645 \u0627\u0644\u0645\u0631\u062d\u0644\u0629 "),u.Rb(11,"span",10),u.Ic(12,"*"),u.Qb(),u.Qb(),u.Rb(13,"div",11),u.Nb(14,"input",12),u.Qb(),u.Qb(),u.Rb(15,"div",8),u.Rb(16,"label",9),u.Ic(17," \u0634\u0631\u062d \u0627\u0644\u062e\u0637\u0648\u0627\u062a "),u.Rb(18,"span",10),u.Ic(19,"*"),u.Qb(),u.Qb(),u.Rb(20,"div",11),u.Nb(21,"textarea",13),u.Qb(),u.Qb(),u.Qb(),u.Rb(22,"label",9),u.Ic(23," \u062d\u0627\u0644\u0629 \u0627\u0644\u0645\u0631\u062d\u0644\u0629 "),u.Rb(24,"span",10),u.Ic(25,"*"),u.Qb(),u.Qb(),u.Rb(26,"div",14),u.Rb(27,"div",15),u.Rb(28,"label",16),u.Rb(29,"span",17),u.Nb(30,"input",18),u.Nb(31,"span",19),u.Qb(),u.Rb(32,"span",20),u.Ic(33,"\u0645\u0643\u062a\u0645\u0644"),u.Qb(),u.Qb(),u.Qb(),u.Rb(34,"div",21),u.Rb(35,"label",16),u.Rb(36,"span",17),u.Nb(37,"input",22),u.Nb(38,"span",19),u.Qb(),u.Rb(39,"span",20),u.Ic(40,"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u0646\u0641\u064a\u0630"),u.Qb(),u.Qb(),u.Qb(),u.Rb(41,"div",15),u.Rb(42,"label",16),u.Rb(43,"span",17),u.Nb(44,"input",23),u.Nb(45,"span",19),u.Qb(),u.Rb(46,"span",20),u.Ic(47,"\u0645\u062a\u0648\u0642\u0641"),u.Qb(),u.Qb(),u.Qb(),u.Rb(48,"div",24),u.Rb(49,"div",11),u.Nb(50,"input",25),u.Qb(),u.Qb(),u.Gc(51,v,2,0,"span",26),u.Qb(),u.Rb(52,"div",7),u.Rb(53,"div",27),u.Rb(54,"label",9),u.Ic(55," \u0646\u0633\u0628\u0629 \u0627\u0644\u0627\u0646\u062c\u0627\u0632 "),u.Rb(56,"span",10),u.Ic(57,"*"),u.Qb(),u.Qb(),u.Rb(58,"div",28),u.Rb(59,"div",29),u.Rb(60,"div",11),u.Nb(61,"input",30),u.Qb(),u.Qb(),u.Rb(62,"div",31),u.Nb(63,"circle-progressbar",32),u.Qb(),u.Qb(),u.Qb(),u.Rb(64,"div",33),u.Rb(65,"label",9),u.Ic(66," \u0631\u0627\u0628\u0637 \u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 "),u.Qb(),u.Rb(67,"div",11),u.Nb(68,"input",34),u.Qb(),u.Qb(),u.Qb(),u.Rb(69,"div",7),u.Rb(70,"div",35),u.Rb(71,"label",9),u.Ic(72," \u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0634\u0631\u0643\u0629 \u0639\u0646 \u0627\u0644\u0645\u0631\u062d\u0644\u0629 "),u.Qb(),u.Rb(73,"div",11),u.Rb(74,"div",36),u.Rb(75,"input",37),u.dc("change",(function(e){return t.uploadReport(e,"company_report")})),u.Qb(),u.Gc(76,_,2,0,"div",38),u.Qb(),u.Nb(77,"i",39),u.Qb(),u.Gc(78,R,6,4,"div",40),u.Qb(),u.Rb(79,"div",35),u.Rb(80,"label",9),u.Ic(81," \u062a\u0642\u0631\u064a\u0631 \u0627\u0644\u0627\u0633\u062a\u0634\u0627\u0631\u064a \u0639\u0646 \u0627\u0644\u0645\u0631\u062d\u0644\u0629 "),u.Qb(),u.Rb(82,"div",11),u.Rb(83,"div",36),u.Rb(84,"input",37),u.dc("change",(function(e){return t.uploadReport(e,"consultant_report")})),u.Qb(),u.Gc(85,Q,2,0,"div",38),u.Qb(),u.Nb(86,"i",39),u.Qb(),u.Gc(87,j,6,4,"div",40),u.Qb(),u.Qb(),u.Rb(88,"div",41),u.Rb(89,"label",9),u.Ic(90," \u0635\u0648\u0631 \u0645\u0646 \u0645\u0631\u0627\u062d\u0644 \u0627\u0644\u062a\u0646\u0641\u064a\u0630 "),u.Qb(),u.Rb(91,"div",42),u.Rb(92,"a",43),u.Nb(93,"i",44),u.Rb(94,"input",45),u.dc("change",(function(e){return t.onuploadImage(e)})),u.Qb(),u.Qb(),u.Gc(95,x,4,1,"div",46),u.Qb(),u.Qb(),u.Qb()),2&e&&(u.oc("formGroup",t.subStageForm),u.zb(2),u.oc("disabled",t.showLoader&&!(null!=t.authService&&null!=t.authService.userData&&t.authService.userData.add_edit)),u.zb(1),u.oc("ngIf",!t.showLoader),u.zb(1),u.oc("ngIf",t.showLoader),u.zb(1),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(9),u.Eb("err",t.subStageFormSubmitted&&t.subStageForm.get("name").invalid),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(7),u.Eb("err",t.subStageFormSubmitted&&t.subStageForm.get("steps_explain").invalid),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(9),u.Eb("checked",1==(null==t.data||null==t.data.status?null:t.data.status.key)&&1==t.subStageForm.get("status").value)("err",t.subStageFormSubmitted&&t.subStageForm.get("status").invalid),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(7),u.Eb("checked",2==(null==t.data||null==t.data.status?null:t.data.status.key)&&2==t.subStageForm.get("status").value)("err",t.subStageFormSubmitted&&t.subStageForm.get("status").invalid),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(7),u.Eb("checked",3==(null==t.data||null==t.data.status?null:t.data.status.key)&&3==t.subStageForm.get("status").value)("err",t.subStageFormSubmitted&&t.subStageForm.get("status").invalid),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(6),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(1),u.oc("ngIf",t.subStageFormSubmitted&&t.subStageForm.get("status").invalid),u.zb(10),u.Eb("err",t.subStageFormSubmitted&&t.subStageForm.get("completion_rate").invalid),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(2),u.oc("containerHeight",30)("scale",!0)("strokeWidth",50)("radius",100)("outerStrokeColor","#F7A719")("percent",t.subStageForm.get("completion_rate").value?t.subStageForm.get("completion_rate").value:0),u.zb(5),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(7),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(1),u.oc("ngIf",t.subStageForm.get("company_report").value),u.zb(2),u.oc("ngIf",t.subStageForm.get("company_report").value),u.zb(6),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(1),u.oc("ngIf",t.subStageForm.get("consultant_report").value),u.zb(2),u.oc("ngIf",t.subStageForm.get("consultant_report").value),u.zb(7),u.Ab("disabled",null==t.authService||null==t.authService.userData||!t.authService.userData.add_edit||null),u.zb(1),u.oc("ngForOf",t.projectImgs))},directives:[c.s,c.k,c.e,i.l,c.b,c.g,c.j,c.d,c.n,m.a,g.a,i.k,c.a],styles:[".btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;display:inline-block;margin-right:3px;border:none;cursor:pointer;color:#186076}.btns[_ngcontent-%COMP%]   button.delete[_ngcontent-%COMP%]{color:#bc4747}.imgs[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-wrap:wrap}.imgs[_ngcontent-%COMP%]   .img-holder[_ngcontent-%COMP%]{position:relative;width:100px;height:100px}.imgs[_ngcontent-%COMP%]   .img-holder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;left:0;top:0;background-color:#186076;width:20px;height:20px;line-height:20px;text-align:center;color:#fff}.form-group[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{top:10px}span.txt-red[_ngcontent-%COMP%]{margin-top:-20px}.report-name[_ngcontent-%COMP%], a.show[_ngcontent-%COMP%], span.txt-red[_ngcontent-%COMP%]{font-size:.9rem}.checkbox-container[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]{right:10px;height:12px;width:12px}.checkbox-container[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{left:3px;top:0;width:4px;height:9px}.report-options[_ngcontent-%COMP%]{margin-top:-15px}"]}),e})();var w=a("PTt/"),k=a("xJkR");function z(e,t){1&e&&(u.Pb(0),u.Ic(1,"\u0627\u0636\u0627\u0641\u0629 \u0645\u0634\u0631\u0648\u0639"),u.Ob())}function P(e,t){1&e&&(u.Pb(0),u.Ic(1,"\u062a\u0639\u062f\u064a\u0644 \u0645\u0634\u0631\u0648\u0639"),u.Ob())}function D(e,t){if(1&e&&(u.Rb(0,"a",31),u.Nb(1,"i",32),u.Qb()),2&e){const e=u.hc(2);u.rc("href","",e.environment.baseEndPointUrl,"/projects/",e.projectId,"/download_full_report/",u.Bc)}}function N(e,t){if(1&e&&(u.Rb(0,"option",33),u.Ic(1),u.Qb()),2&e){const e=t.$implicit;u.oc("value",e.id),u.zb(1),u.Kc(" ",e.username," ")}}function G(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",52),u.Rb(1,"sub-stage",53),u.dc("deleteSubStage",(function(t){return u.zc(e),u.hc(3).deleteSubStage(t)}))("refresh",(function(t){return u.zc(e),u.hc(3).refresh(t)})),u.Qb(),u.Qb()}if(2&e){const e=t.$implicit,a=t.index,i=u.hc(3);u.zb(1),u.oc("data",e.id?e:null)("type","foundation")("index",a)("mainStageId",i.foundationId)}}function C(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",54),u.Rb(1,"general-summary",55),u.dc("deleteGeneralSummary",(function(t){return u.zc(e),u.hc(3).deleteGeneralSummary(t)}))("refreshSummary",(function(t){return u.zc(e),u.hc(3).refresh(t)})),u.Qb(),u.Qb()}if(2&e){const e=u.hc(3);u.zb(1),u.oc("data",e.foundationGeneralSummaryData)("mainStageId",e.foundationId)("type","foundation")("id",e.foundationId)}}function M(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",52),u.Rb(1,"sub-stage",53),u.dc("deleteSubStage",(function(t){return u.zc(e),u.hc(3).deleteSubStage(t)}))("refresh",(function(t){return u.zc(e),u.hc(3).refresh(t)})),u.Qb(),u.Qb()}if(2&e){const e=t.$implicit,a=t.index,i=u.hc(3);u.zb(1),u.oc("data",e.id?e:null)("type","building")("index",a)("mainStageId",i.buildingId)}}function O(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",54),u.Rb(1,"general-summary",55),u.dc("deleteGeneralSummary",(function(t){return u.zc(e),u.hc(3).deleteGeneralSummary(t)}))("refreshSummary",(function(t){return u.zc(e),u.hc(3).refresh(t)})),u.Qb(),u.Qb()}if(2&e){const e=u.hc(3);u.zb(1),u.oc("data",e.buildingGeneralSummaryData)("mainStageId",e.buildingId)("type","building")("id",e.buildingId)}}function A(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",52),u.Rb(1,"sub-stage",53),u.dc("deleteSubStage",(function(t){return u.zc(e),u.hc(3).deleteSubStage(t)}))("refresh",(function(t){return u.zc(e),u.hc(3).refresh(t)})),u.Qb(),u.Qb()}if(2&e){const e=t.$implicit,a=t.index,i=u.hc(3);u.zb(1),u.oc("data",e.id?e:null)("type","finishing")("index",a)("mainStageId",i.finishingId)}}function E(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",54),u.Rb(1,"general-summary",55),u.dc("deleteGeneralSummary",(function(t){return u.zc(e),u.hc(3).deleteGeneralSummary(t)}))("refreshSummary",(function(t){return u.zc(e),u.hc(3).refresh(t)})),u.Qb(),u.Qb()}if(2&e){const e=u.hc(3);u.zb(1),u.oc("data",e.finishingGeneralSummaryData)("mainStageId",e.finishingId)("type","finishing")("id",e.finishingId)}}function q(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",34),u.Rb(1,"div",35),u.Rb(2,"div",36),u.Rb(3,"div",37),u.Rb(4,"h4",38),u.Nb(5,"i",39),u.Ic(6," \u0627\u0644\u0623\u0633\u0627\u0633\u0627\u062a "),u.Qb(),u.Rb(7,"div",40),u.Rb(8,"button",41),u.dc("click",(function(){return u.zc(e),u.hc(2).addSubStage("foundation")})),u.Nb(9,"i",42),u.Ic(10," \u0627\u0636\u0627\u0641\u0629 \u0645\u0631\u062d\u0644\u0629 "),u.Qb(),u.Rb(11,"button",43),u.dc("click",(function(){u.zc(e);const t=u.hc(2);return t.foundationGeneralSummary=!0,t.addGeneralSummary("foundation")})),u.Nb(12,"i",44),u.Ic(13," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),u.Qb(),u.Qb(),u.Qb(),u.Rb(14,"div",45),u.Gc(15,G,2,4,"div",46),u.Gc(16,C,2,4,"div",47),u.Qb(),u.Qb(),u.Rb(17,"div",36),u.Rb(18,"div",37),u.Rb(19,"h4",38),u.Nb(20,"i",48),u.Ic(21," \u0627\u0644\u0645\u0628\u0627\u0646\u064a "),u.Qb(),u.Rb(22,"div",40),u.Rb(23,"button",41),u.dc("click",(function(){return u.zc(e),u.hc(2).addSubStage("building")})),u.Nb(24,"i",42),u.Ic(25," \u0627\u0636\u0627\u0641\u0629 \u0645\u0631\u062d\u0644\u0629 "),u.Qb(),u.Rb(26,"button",43),u.dc("click",(function(){u.zc(e);const t=u.hc(2);return t.buildingGeneralSummary=!0,t.addGeneralSummary("building")})),u.Nb(27,"i",44),u.Ic(28," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),u.Qb(),u.Qb(),u.Qb(),u.Rb(29,"div",49),u.Gc(30,M,2,4,"div",46),u.Gc(31,O,2,4,"div",47),u.Qb(),u.Qb(),u.Rb(32,"div",36),u.Rb(33,"div",37),u.Rb(34,"h4",38),u.Nb(35,"i",50),u.Ic(36," \u0627\u0644\u062a\u0634\u0637\u064a\u0628 "),u.Qb(),u.Rb(37,"div",40),u.Rb(38,"button",41),u.dc("click",(function(){return u.zc(e),u.hc(2).addSubStage("finishing")})),u.Nb(39,"i",42),u.Ic(40," \u0627\u0636\u0627\u0641\u0629 \u0645\u0631\u062d\u0644\u0629 "),u.Qb(),u.Rb(41,"button",43),u.dc("click",(function(){u.zc(e);const t=u.hc(2);return t.finishingGeneralSummary=!0,t.addGeneralSummary("finishing")})),u.Nb(42,"i",44),u.Ic(43," \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0639\u0627\u0645 "),u.Qb(),u.Qb(),u.Qb(),u.Rb(44,"div",51),u.Gc(45,A,2,4,"div",46),u.Gc(46,E,2,4,"div",47),u.Qb(),u.Qb(),u.Qb(),u.Qb()}if(2&e){const e=u.hc(2);u.zb(8),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(3),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(4),u.oc("ngForOf",e.foundationSteps),u.zb(1),u.oc("ngIf",e.foundationGeneralSummary),u.zb(7),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(3),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(4),u.oc("ngForOf",e.buildingSteps),u.zb(1),u.oc("ngIf",e.buildingGeneralSummary),u.zb(7),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(3),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(4),u.oc("ngForOf",e.finishingSteps),u.zb(1),u.oc("ngIf",e.finishingGeneralSummary)}}function B(e,t){if(1&e){const e=u.Sb();u.Rb(0,"div",2),u.Rb(1,"div",3),u.Rb(2,"div",4),u.Rb(3,"div",5),u.Rb(4,"h3"),u.Nb(5,"i",6),u.Gc(6,z,2,0,"ng-container",7),u.Gc(7,P,2,0,"ng-container",7),u.Qb(),u.Rb(8,"div"),u.Gc(9,D,2,2,"a",8),u.Rb(10,"a",9),u.Nb(11,"i",10),u.Qb(),u.Qb(),u.Qb(),u.Rb(12,"div",11),u.Rb(13,"form",12),u.dc("ngSubmit",(function(){u.zc(e);const t=u.hc();return t.addProject(t.projectForm.value)})),u.Rb(14,"div",2),u.Rb(15,"div",13),u.Rb(16,"label",14),u.Nb(17,"i",15),u.Ic(18," \u0627\u0633\u0645 \u0627\u0644\u0645\u0634\u0631\u0648\u0639 "),u.Rb(19,"span",16),u.Ic(20,"*"),u.Qb(),u.Qb(),u.Rb(21,"div",17),u.Nb(22,"input",18),u.Qb(),u.Qb(),u.Rb(23,"div",13),u.Rb(24,"label",14),u.Nb(25,"i",19),u.Ic(26," \u0627\u0644\u0639\u0645\u064a\u0644 "),u.Rb(27,"span",16),u.Ic(28,"*"),u.Qb(),u.Qb(),u.Rb(29,"div",17),u.Rb(30,"select",20),u.Rb(31,"option",21),u.Ic(32," \u0627\u062e\u062a\u0631 "),u.Qb(),u.Gc(33,N,2,2,"option",22),u.Qb(),u.Qb(),u.Qb(),u.Rb(34,"div",13),u.Rb(35,"label",14),u.Nb(36,"i",23),u.Ic(37," \u0643\u0648\u062f \u0627\u0644\u0645\u0634\u0631\u0648\u0639 "),u.Rb(38,"span",16),u.Ic(39,"*"),u.Qb(),u.Qb(),u.Rb(40,"div",17),u.Nb(41,"input",24),u.Qb(),u.Qb(),u.Rb(42,"div",13),u.Rb(43,"label",14),u.Nb(44,"i",25),u.Ic(45," \u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0645\u0634\u0631\u0648\u0639 "),u.Rb(46,"span",16),u.Ic(47,"*"),u.Qb(),u.Qb(),u.Rb(48,"div",17),u.Nb(49,"input",26),u.Qb(),u.Qb(),u.Qb(),u.Rb(50,"div",27),u.Rb(51,"button",28),u.Nb(52,"i",29),u.Ic(53," \u062d\u0641\u0638 "),u.Qb(),u.Qb(),u.Qb(),u.Gc(54,q,47,12,"div",30),u.Qb(),u.Qb(),u.Qb(),u.Qb()}if(2&e){const e=u.hc();u.zb(6),u.oc("ngIf","add"===e.pageType),u.zb(1),u.oc("ngIf","edit"===e.pageType),u.zb(2),u.oc("ngIf","edit"===e.pageType&&e.authService.userData.reports_download),u.zb(4),u.oc("formGroup",e.projectForm),u.zb(9),u.Eb("err",e.projectFormSubmitted&&e.projectForm.get("name").invalid),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(8),u.Eb("err",e.projectFormSubmitted&&e.projectForm.get("client").invalid),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(3),u.oc("ngForOf",e.clients),u.zb(8),u.Eb("err",e.projectFormSubmitted&&e.projectForm.get("code").invalid),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(8),u.Eb("err",e.projectFormSubmitted&&e.projectForm.get("address").invalid),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(2),u.Ab("disabled",null==e.authService||null==e.authService.userData||!e.authService.userData.add_edit||null),u.zb(3),u.oc("ngIf",e.isProjectAdded)}}function T(e,t){1&e&&u.Nb(0,"ngx-skeleton-loader",56)}let L=(()=>{class e{constructor(e,t,a,i,n,s,o){this.formBuilder=e,this.clientsService=t,this.apiService=a,this.toaster=i,this.router=n,this.projectsService=s,this.authService=o,this.isProjectAdded=!1,this.projectFormSubmitted=!1,this.foundationSteps=[],this.foundationGeneralSummary=!1,this.buildingGeneralSummary=!1,this.finishingGeneralSummary=!1,this.foundationCount=0,this.buildingCount=0,this.finishingCount=0,this.buildingSteps=[],this.finishingSteps=[],this.pageType="add",this.editpageLoading=!0,this.environment=r.a}ngOnInit(){this.createForm(),this.router.params.subscribe(e=>{e.id?(this.projectId=e.id,this.getProjectDetails(e.id,!0),this.pageType="edit",this.projectForm.get("client").disable()):this.editpageLoading=!1}),this.getClients()}getClients(){this.clientsService.getClients().subscribe(e=>{e.status&&(this.clients=e.data)})}createForm(){this.projectForm=this.formBuilder.group({name:[null,[c.q.required]],client:["",[c.q.required]],code:[null,[c.q.required]],address:[null,[c.q.required]]}),this.addProjectForm=this.formBuilder.group({bases:this.formBuilder.array([]),buildings:this.formBuilder.array([]),finishing:this.formBuilder.array([])})}addProject(e){this.projectFormSubmitted=!0,e.name&&("add"===this.pageType?this.apiService.postReq("projects/",e).subscribe(e=>{e.status?(this.toaster.showSuccess("\u062a\u0645 \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0634\u0631\u0648\u0639 \u0628\u0646\u062c\u0627\u062d"),this.projectsService.projects=null,this.getProjectDetails(e.data.id),this.projectId=e.data.id):this.toaster.showError(e.message)},e=>{this.toaster.showError()}):"edit"===this.pageType&&this.apiService.patchReq(`projects/${this.editProject.id}/`,e).subscribe(e=>{e.status?this.toaster.showSuccess("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0627\u0644\u0645\u0634\u0631\u0648\u0639 \u0628\u0646\u062c\u0627\u062d"):this.toaster.showError(e.message)},e=>{this.toaster.showError()}))}getProjectDetails(e,t=!1){e&&this.apiService.getReq(`projects/${e}/`).subscribe(e=>{e.status?(this.editProject=e.data,t&&(this.editpageLoading=!1,this.isProjectAdded=!0,this.projectForm.patchValue({name:this.editProject.name,client:this.editProject.client.id,code:this.editProject.code,address:this.editProject.address})),e.data.foundation.forEach(e=>{e.sub_stages.length&&(this.foundationSteps=e.sub_stages,e.steps_explain&&(this.foundationGeneralSummary=!0,this.foundationGeneralSummaryData={steps_explain:e.steps_explain,consultant_general_summary:e.consultant_general_summary,company_general_summary:e.company_general_summary})),e.is_report||(this.foundationId=e.id)}),e.data.building.forEach(e=>{e.sub_stages.length&&(this.buildingSteps=e.sub_stages,e.steps_explain&&(this.buildingGeneralSummary=!0,this.buildingGeneralSummaryData={steps_explain:e.steps_explain,consultant_general_summary:e.consultant_general_summary,company_general_summary:e.company_general_summary})),e.is_report||(this.buildingId=e.id)}),e.data.finishing.forEach(e=>{e.sub_stages.length&&(this.finishingSteps=e.sub_stages,e.steps_explain&&(this.finishingGeneralSummary=!0,this.finishingGeneralSummaryData={steps_explain:e.steps_explain,consultant_general_summary:e.consultant_general_summary,company_general_summary:e.company_general_summary})),e.is_report||(this.finishingId=e.id)}),this.isProjectAdded=!0):this.toaster.showError(e.message)},e=>{this.toaster.showError()})}addSubStage(e){switch(e){case"foundation":this.foundationSteps.push({type:e,index:this.foundationCount++});break;case"building":this.buildingSteps.push({type:e,index:this.buildingCount++});break;case"finishing":this.finishingSteps.push({type:e,index:this.finishingCount++})}setTimeout(()=>{document.querySelectorAll("."+e+" .sub")[document.querySelectorAll("."+e+" .sub").length-1].scrollIntoView()},200)}addGeneralSummary(e){setTimeout(()=>{document.querySelectorAll("."+e+" .general")[document.querySelectorAll("."+e+" .general").length-1].scrollIntoView()},200)}deleteSubStage(e){if(e.id)o.a.fire({title:"\u0647\u0644 \u0627\u0646\u062a \u0645\u062a\u0627\u0643\u062f \u061f",icon:"danger",showCancelButton:!0,confirmButtonText:"\u0646\u0639\u0645",cancelButtonText:"\u0627\u0644\u063a\u0627\u0621"}).then(t=>{t.value&&this.apiService.deleteReq(`sub-stages/${e.id}/`).subscribe(t=>{if(t.status){switch(e.type){case"foundation":this.foundationSteps.splice(e.index,1);break;case"building":this.buildingSteps.splice(e.index,1);break;case"finishing":this.finishingSteps.splice(e.index,1)}o.a.fire("\u062a\u0645")}else this.toaster.showError(t.message)},e=>{this.toaster.showError()})});else switch(e.type){case"foundation":this.foundationSteps.splice(e.index,1);break;case"building":this.buildingSteps.splice(e.index,1);break;case"finishing":this.finishingSteps.splice(e.index,1)}}refresh(e){e&&this.getProjectDetails(this.projectId,!0)}deleteGeneralSummary(e){switch(e.type){case"foundation":this.foundationGeneralSummary=!1;break;case"building":this.buildingGeneralSummary=!1;break;case"finishing":this.finishingGeneralSummary=!1}}addReport(e){}get bases(){return this.addProjectForm.get("bases")}get buildings(){return this.addProjectForm.get("buildings")}get finishing(){return this.addProjectForm.get("finishing")}newBase(){return this.formBuilder.group({})}newBuilding(){return this.formBuilder.group({})}newFinish(){return this.formBuilder.group({})}addNewBase(e){this.bases.push(e)}addNewBuilding(e){this.bases.push(e)}addNewFinish(e){this.bases.push(e)}}return e.\u0275fac=function(t){return new(t||e)(u.Mb(c.c),u.Mb(l.a),u.Mb(d.a),u.Mb(b.a),u.Mb(n.a),u.Mb(h.a),u.Mb(p.a))},e.\u0275cmp=u.Gb({type:e,selectors:[["add-projects"]],decls:2,vars:2,consts:[["class","row",4,"ngIf"],["count","10","animation","pulse",4,"ngIf"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-title","add","d-flex","justify-content-between"],[1,"fas","fa-home","ml-1"],[4,"ngIf"],["class","back-icon ml-3","target","blank",3,"href",4,"ngIf"],["routerLink","/landing/projects",1,"back-icon"],[1,"fas","fa-chevron-left"],[1,"card-body"],[1,"form",3,"formGroup","ngSubmit"],[1,"col-md-3","col-sm-6"],["for","",1,"control-label"],[1,"fas","fa-home"],[1,"annotation-required"],[1,"form-group"],["type","text","formControlName","name",1,"form-control"],[1,"fas","fa-user"],["formControlName","client",1,"form-control","select"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"fas","fa-calendar"],["numbersOnly","","type","text","formControlName","code",1,"form-control"],[1,"fas","fa-map-marker-alt"],["type","text","formControlName","address",1,"form-control"],[1,"d-flex","justify-content-end","action-btns"],["type","submit",1,"btn","btn-green"],[1,"fas","fa-save"],["class","steps",4,"ngIf"],["target","blank",1,"back-icon","ml-3",3,"href"],[1,"fas","fa-file-pdf"],[3,"value"],[1,"steps"],[1,"row","no-gutters"],[1,"step","col-lg-4"],[1,"step-title","row","no-gutters"],[1,"col-sm-4"],[1,"fas","fa-tools"],[1,"col-sm-8"],["type","button",1,"btn","btn-orange","ml-1",3,"click"],[1,"fas","fa-plus-circle"],["type","button",1,"btn","btn-orange",3,"click"],[1,"fas","fa-file-alt"],[1,"step-body","foundation"],["class","sub-stage sub",4,"ngFor","ngForOf"],["class","sub-stage general",4,"ngIf"],[1,"fas","fa-building"],[1,"step-body","building"],[1,"fas","fa-paint-roller"],[1,"step-body","finishing"],[1,"sub-stage","sub"],[3,"data","type","index","mainStageId","deleteSubStage","refresh"],[1,"sub-stage","general"],[3,"data","mainStageId","type","id","deleteGeneralSummary","refreshSummary"],["count","10","animation","pulse"]],template:function(e,t){1&e&&(u.Gc(0,B,55,19,"div",0),u.Gc(1,T,1,0,"ngx-skeleton-loader",1)),2&e&&(u.oc("ngIf",!t.editpageLoading),u.zb(1),u.oc("ngIf","edit"===t.pageType&&t.editpageLoading))},directives:[i.l,n.e,c.s,c.k,c.e,c.b,c.j,c.d,c.p,c.m,c.r,i.k,m.a,F,w.a,k.a],styles:[".form-control[_ngcontent-%COMP%]{padding-right:10px}"]}),e})();var $=a("yByJ"),V=a("lkLn");const K=function(){return{name:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0634\u0631\u0648\u0639",nameKey:"name",icon:"fas fa-home"}},J=function(){return{name:"\u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064a\u0644",nameKey:"client",icon:"fas fa-user"}},H=function(){return{name:"\u0646\u0633\u0628\u0629 \u0627\u0644\u0627\u0646\u062c\u0627\u0632",nameKey:"total_completion_rate",icon:"fas fa-circle-notch"}},U=function(e,t,a){return[e,t,a]},W=[{path:"",component:(()=>{class e{constructor(e,t,a,i,n){this.projectsService=e,this.router=t,this.toaster=a,this.apiService=i,this.headerData=n,n.showSideBar=!1}ngOnInit(){this.getProjects()}getProjects(){this.projectsService.getProjects().subscribe(e=>{e.status?this.projects=e.data:this.toaster.showError(e.message)},e=>{this.toaster.showError(e.statusText)})}addProject(){this.router.navigate(["/landing/projects/add"])}editProject(e){this.router.navigate(["/landing/projects/edit/"+e.id]),this.projectsService.editableProject=e}deleteProject(e){o.a.fire({title:"\u0647\u0644 \u0627\u0646\u062a \u0645\u062a\u0627\u0643\u062f \u061f",icon:"danger",showCancelButton:!0,confirmButtonText:"\u0646\u0639\u0645",cancelButtonText:"\u0627\u0644\u063a\u0627\u0621"}).then(t=>{t.value&&this.apiService.deleteReq(`projects/${e}/`).subscribe(e=>{e.status?(this.getProjects(),setTimeout(()=>{o.a.fire("\u062a\u0645")},2e3)):this.toaster.showError(e.message)},e=>{this.toaster.showError()})})}}return e.\u0275fac=function(t){return new(t||e)(u.Mb(h.a),u.Mb(n.b),u.Mb(b.a),u.Mb(d.a),u.Mb($.a))},e.\u0275cmp=u.Gb({type:e,selectors:[["projects"]],decls:3,vars:10,consts:[[1,"row"],[1,"col-md-12"],[3,"addLabel","data","tableHeads","add","edit","delete"]],template:function(e,t){1&e&&(u.Rb(0,"div",0),u.Rb(1,"div",1),u.Rb(2,"data-table",2),u.dc("add",(function(){return t.addProject()}))("edit",(function(e){return t.editProject(e)}))("delete",(function(e){return t.deleteProject(e)})),u.Qb(),u.Qb(),u.Qb()),2&e&&(u.zb(2),u.oc("addLabel","\u0627\u0636\u0627\u0641\u0629 \u0645\u0634\u0631\u0648\u0639")("data",t.projects)("tableHeads",u.vc(6,U,u.sc(3,K),u.sc(4,J),u.sc(5,H))))},directives:[V.a],styles:[".progress__svg[_ngcontent-%COMP%]{transform:rotate(-90deg)}.progress__meter[_ngcontent-%COMP%], .progress__value[_ngcontent-%COMP%]{fill:none}.progress__meter[_ngcontent-%COMP%]{stroke:#ccc}.progress__value[_ngcontent-%COMP%]{stroke:#4caf50;transition:all}"]}),e})()},{path:"add",component:L},{path:"edit/:id",component:L}];let X=(()=>{class e{}return e.\u0275mod=u.Kb({type:e}),e.\u0275inj=u.Jb({factory:function(t){return new(t||e)},imports:[[n.f.forChild(W)],n.f]}),e})();var Z=a("PCNd");let Y=(()=>{class e{}return e.\u0275mod=u.Kb({type:e}),e.\u0275inj=u.Jb({factory:function(t){return new(t||e)},imports:[[i.b,X,Z.a,c.f,c.o]]}),e})()}}]);