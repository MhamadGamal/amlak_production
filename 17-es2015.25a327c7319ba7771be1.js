(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{XEKE:function(e,s,r){"use strict";r.r(s),r.d(s,"SettingsModule",(function(){return y}));var t=r("ofXK"),i=r("3Pt+"),o=r("fXoL"),a=r("vkgz"),d=r("nm5K");let n=(()=>{class e{constructor(e){this.apiService=e}get users(){return this._users}set users(e){this._users=e}getStaffUsers(){return this.apiService.getReq("staff-users/").pipe(Object(a.a)(e=>{e.status&&(this.users=e.data)}))}getUserDetails(e){return this.users.find(s=>s.id==e)}}return e.\u0275fac=function(s){return new(s||e)(o.Zb(d.a))},e.\u0275prov=o.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var b=r("mAmA"),u=r("tyNb"),l=r("Pd9Q");function c(e,s){if(1&e&&(o.Rb(0,"div",26),o.Rb(1,"label",27),o.Nb(2,"input",28),o.Nb(3,"span",29),o.Hc(4),o.Qb(),o.Qb()),2&e){const e=s.$implicit,r=s.index;o.zb(2),o.oc("value",e.value)("formControlName",e.value)("checked",0===r),o.zb(2),o.Jc(" ",e.key," ")}}let m=(()=>{class e{constructor(e,s,r,t,i){this.formBuilder=e,this.usersService=s,this.toaster=r,this.router=t,this.apiService=i,this.formSubmitted=!1,this.roles=[{key:"\u0627\u0644\u0627\u0637\u0644\u0627\u0639 \u0641\u0642\u0637",value:"view_only"},{key:"\u0627\u0645\u0643\u0627\u0646\u064a\u0629 \u062a\u0646\u0632\u064a\u0644 \u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631",value:"reports_download"},{key:"\u0627\u0644\u0627\u0636\u0627\u0641\u0629 \u0648\u0627\u0644\u062a\u0639\u062f\u064a\u0644",value:"add_edit"},{key:"\u0627\u0644\u062d\u0630\u0641",value:"delete_permission"}],this.pageType="add"}ngOnInit(){this.createForm(),this.router.params.subscribe(e=>{e.id&&(this.id=e.id)}),this.usersService.users?(this.users=this.usersService.users,this.fillUserData()):this.getUsers()}createForm(){this.addUserForm=this.formBuilder.group({full_name:[null,[i.p.required]],phone_number:[null,[i.p.required]],email:[null,[i.p.required,i.p.email]],username:[null,[i.p.required]],new_password1:[null,[i.p.required]],view_only:[!0,[i.p.required]],reports_download:[!1,[i.p.required]],add_edit:[!1,[i.p.required]],delete_permission:[!1,[i.p.required]]})}getUsers(){this.usersService.getStaffUsers().subscribe(e=>{e.status?(this.users=e.data,this.id&&this.fillUserData()):this.toaster.showError(e.message)},e=>{this.toaster.showError()})}fillUserData(){if(this.id){const e=this.usersService.getUserDetails(this.id);this.addUserForm.patchValue({full_name:e.full_name,phone_number:e.phone_number,email:e.email,username:e.username,new_password1:"",view_only:e.view_only,reports_download:e.reports_download,add_edit:e.add_edit,delete_permission:e.delete_permission})}}addUser(e){this.formSubmitted=!0,this.id?this.apiService.patchReq(`staff-users/${this.id}/`,{view_only:e.view_only,reports_download:e.reports_download,add_edit:e.add_edit,delete_permission:e.delete_permission}).subscribe(e=>{e.status?(this.formSubmitted=!1,this.usersService.users=null,this.toaster.showSuccess("\u062a\u0645 \u062a\u0639\u062f\u064a\u0644 \u0635\u0644\u0627\u062d\u064a\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0628\u0646\u062c\u0627\u062d")):(this.toaster.showError(e.message),this.formSubmitted=!1)},e=>{this.toaster.showError(),this.formSubmitted=!1}):(e.new_password2=e.new_password1,this.apiService.postReq("staff-users/",e).subscribe(e=>{e.status?(this.toaster.showSuccess("\u062a\u0645 \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 \u0628\u0646\u062c\u0627\u062d"),this.usersService.users=null,this.formSubmitted=!1):(this.toaster.showError(e.errors.length?e.errors[0]:e.message),this.formSubmitted=!1)},e=>{this.formSubmitted=!1,this.toaster.showError()}))}get rolesFilds(){return this.addUserForm.get("roles")}}return e.\u0275fac=function(s){return new(s||e)(o.Mb(i.c),o.Mb(n),o.Mb(b.a),o.Mb(u.a),o.Mb(d.a))},e.\u0275cmp=o.Gb({type:e,selectors:[["add-user"]],decls:64,vars:20,consts:[[1,"card"],[1,"card-title","add"],[1,"fas","fa-user-plus"],[1,"card-body"],[1,"form",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-md-4","col-sm-6"],[1,"form-group"],[1,"control-label"],[1,"annotation-required"],["type","text","formControlName","full_name",1,"form-control",3,"disabled"],[1,"fas","fa-user"],["type","text","numbersOnly","","formControlName","phone_number",1,"form-control",3,"disabled"],[1,"fas","fa-mobile-alt"],["type","email","formControlName","email",1,"form-control",3,"disabled"],[1,"fas","fa-envelope"],["type","text","formControlName","username",1,"form-control",3,"disabled"],["type","password","formControlName","new_password1",1,"form-control",3,"disabled"],[1,"fas","fa-lock"],[1,"col-12"],["class","my-3 col-lg-2 col-md-3 col-sm-6",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end"],["type","submit",1,"btn","btn-green",3,"disabled"],[1,"fas","fa-save"],["routerLink","/landing/settings",1,"btn","btn-red","mr-2"],[1,"fas","fa-times-circle"],[1,"my-3","col-lg-2","col-md-3","col-sm-6"],[1,"checkbox-container"],["type","checkbox",3,"value","formControlName","checked"],[1,"checkmark"]],template:function(e,s){1&e&&(o.Rb(0,"div",0),o.Rb(1,"div",1),o.Rb(2,"h3"),o.Nb(3,"i",2),o.Hc(4," \u0627\u0636\u0627\u0641\u0629 \u0645\u0633\u062a\u062e\u062f\u0645 "),o.Qb(),o.Qb(),o.Rb(5,"div",3),o.Rb(6,"form",4),o.dc("ngSubmit",(function(){return s.addUser(s.addUserForm.value)})),o.Rb(7,"div",5),o.Rb(8,"div",6),o.Rb(9,"div",7),o.Rb(10,"label",8),o.Hc(11," \u0627\u0644\u0627\u0633\u0645 "),o.Rb(12,"span",9),o.Hc(13,"*"),o.Qb(),o.Qb(),o.Nb(14,"input",10),o.Nb(15,"i",11),o.Qb(),o.Qb(),o.Rb(16,"div",6),o.Rb(17,"div",7),o.Rb(18,"label",8),o.Hc(19," \u0631\u0642\u0645 \u0627\u0644\u062c\u0648\u0627\u0644 "),o.Rb(20,"span",9),o.Hc(21,"*"),o.Qb(),o.Qb(),o.Nb(22,"input",12),o.Nb(23,"i",13),o.Qb(),o.Qb(),o.Rb(24,"div",6),o.Rb(25,"div",7),o.Rb(26,"label",8),o.Hc(27," \u0627\u0644\u0628\u0631\u064a\u062f \u0627\u0644\u0627\u0643\u062a\u0631\u0648\u0646\u064a "),o.Rb(28,"span",9),o.Hc(29,"*"),o.Qb(),o.Qb(),o.Nb(30,"input",14),o.Nb(31,"i",15),o.Qb(),o.Qb(),o.Rb(32,"div",6),o.Rb(33,"div",7),o.Rb(34,"label",8),o.Hc(35," \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 "),o.Rb(36,"span",9),o.Hc(37,"*"),o.Qb(),o.Qb(),o.Nb(38,"input",16),o.Nb(39,"i",11),o.Qb(),o.Qb(),o.Rb(40,"div",6),o.Rb(41,"div",7),o.Rb(42,"label",8),o.Hc(43," \u0627\u0644\u0631\u0642\u0645 \u0627\u0644\u0633\u0631\u064a "),o.Rb(44,"span",9),o.Hc(45,"*"),o.Qb(),o.Qb(),o.Nb(46,"input",17),o.Nb(47,"i",18),o.Qb(),o.Qb(),o.Qb(),o.Rb(48,"div",5),o.Rb(49,"div",19),o.Rb(50,"div",7),o.Rb(51,"label",8),o.Hc(52," \u0635\u0644\u0627\u062d\u064a\u0627\u062a \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645 "),o.Rb(53,"span",9),o.Hc(54,"*"),o.Qb(),o.Qb(),o.Rb(55,"div",5),o.Fc(56,c,5,4,"div",20),o.Qb(),o.Qb(),o.Rb(57,"div",21),o.Rb(58,"button",22),o.Nb(59,"i",23),o.Hc(60," \u062d\u0641\u0638 "),o.Qb(),o.Rb(61,"a",24),o.Nb(62,"i",25),o.Hc(63," \u0627\u0644\u063a\u0627\u0621"),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Qb()),2&e&&(o.zb(6),o.oc("formGroup",s.addUserForm),o.zb(8),o.Eb("err",s.formSubmitted&&s.addUserForm.get("full_name").invalid),o.oc("disabled",s.id),o.zb(8),o.Eb("err",s.formSubmitted&&s.addUserForm.get("phone_number").invalid),o.oc("disabled",s.id),o.zb(8),o.Eb("err",s.formSubmitted&&s.addUserForm.get("email").invalid),o.oc("disabled",s.id),o.zb(8),o.Eb("err",s.formSubmitted&&s.addUserForm.get("username").invalid),o.oc("disabled",s.id),o.zb(8),o.Eb("err",s.formSubmitted&&s.addUserForm.get("new_password1").invalid),o.oc("disabled",s.id),o.zb(10),o.oc("ngForOf",s.roles),o.zb(2),o.Eb("actionBtn",s.formSubmitted),o.oc("disabled",s.formSubmitted))},directives:[i.r,i.j,i.e,i.b,i.i,i.d,l.a,t.k,u.e,i.a],styles:[""]}),e})();var f=r("PdH4"),h=r.n(f),p=r("lkLn");const v=function(){return{name:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645",nameKey:"username",icon:"fas fa-user"}},w=function(){return{name:"\u0631\u0642\u0645 \u0627\u0644\u062c\u0648\u0627\u0644",nameKey:"phone_number",icon:"fas fa-mobile-alt"}},g=function(){return{name:"\u0627\u0644\u0628\u0631\u064a\u062f \u0627\u0644\u0627\u0644\u0643\u062a\u0631\u0648\u0646\u064a",nameKey:"email",icon:"fas fa-envelope"}},R=function(e,s,r){return[e,s,r]},_=[{path:"",component:(()=>{class e{constructor(e,s,r,t){this.usersService=e,this.router=s,this.toaster=r,this.apiService=t}ngOnInit(){this.usersService.users?this.users=this.usersService.users:this.getUsers()}getUsers(){this.usersService.getStaffUsers().subscribe(e=>{e.status?this.users=e.data:this.toaster.showError(e.message)},e=>{this.toaster.showError()})}addUser(){this.router.navigate(["/landing/settings/add-user"])}editUser(e){this.router.navigate(["/landing/settings/edit-user/"+e.id])}deleteUser(e){h.a.fire({title:"\u0647\u0644 \u0627\u0646\u062a \u0645\u062a\u0627\u0643\u062f \u061f",icon:"danger",showCancelButton:!0,confirmButtonText:"\u0646\u0639\u0645",cancelButtonText:"\u0627\u0644\u063a\u0627\u0621"}).then(s=>{s.value&&this.apiService.deleteReq(`staff-users/${e}/`).subscribe(e=>{e.status?(this.getUsers(),h.a.fire("\u062a\u0645")):this.toaster.showError(e.message)},e=>{this.toaster.showError()})})}}return e.\u0275fac=function(s){return new(s||e)(o.Mb(n),o.Mb(u.b),o.Mb(b.a),o.Mb(d.a))},e.\u0275cmp=o.Gb({type:e,selectors:[["settings"]],decls:3,vars:10,consts:[[1,"row"],[1,"col-md-12"],[3,"data","addLabel","tableHeads","add","edit","delete"]],template:function(e,s){1&e&&(o.Rb(0,"div",0),o.Rb(1,"div",1),o.Rb(2,"data-table",2),o.dc("add",(function(){return s.addUser()}))("edit",(function(e){return s.editUser(e)}))("delete",(function(e){return s.deleteUser(e)})),o.Qb(),o.Qb(),o.Qb()),2&e&&(o.zb(2),o.oc("data",s.users)("addLabel"," \u0627\u0636\u0627\u0641\u0629 \u0645\u0633\u062a\u062e\u062f\u0645")("tableHeads",o.uc(6,R,o.rc(3,v),o.rc(4,w),o.rc(5,g))))},directives:[p.a],styles:[""]}),e})()},{path:"add-user",component:m},{path:"edit-user/:id",component:m}];let Q=(()=>{class e{}return e.\u0275mod=o.Kb({type:e}),e.\u0275inj=o.Jb({factory:function(s){return new(s||e)},imports:[[u.f.forChild(_)],u.f]}),e})();var S=r("PCNd");let y=(()=>{class e{}return e.\u0275mod=o.Kb({type:e}),e.\u0275inj=o.Jb({factory:function(s){return new(s||e)},imports:[[t.b,Q,S.a,i.f,i.n,S.a]]}),e})()}}]);